<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBRæè´¨è¯†åˆ«ç³»ç»Ÿ - ä¸‹æ‹‰èœå•ç‰ˆ</title>
    
    <!-- å¼•å…¥ Atomm UI æ ·å¼ -->
    <link rel="stylesheet" href="https://minio-download.makeblock.com/resource/atomm-ui-umd/dist-browser/atomm-ui.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .panel h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(52, 152, 219, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #2980b9;
            background: rgba(52, 152, 219, 0.1);
        }
        
        .upload-area.dragover {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .material-selection {
            margin-top: 20px;
        }
        
        .material-selection h4 {
            color: #34495e;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .dropdown-container {
            margin-bottom: 15px;
        }
        
        .dropdown-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .material-dropdown {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .material-dropdown:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .material-dropdown:hover {
            border-color: #bdc3c7;
        }
        
        .results-panel {
            grid-column: 1 / -1;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .result-item h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .result-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .result-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            transition: width 0.3s ease;
        }
        
        .confidence-high {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
        }
        
        .confidence-medium {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }
        
        .confidence-low {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .status.success {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        
        .status.error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .status.info {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .enhanced-features {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .enhanced-features h4 {
            color: #27ae60;
            margin-bottom: 15px;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .feature-list li {
            padding: 5px 0;
            color: #2c3e50;
        }
        
        .feature-list li:before {
            content: "âœ“";
            color: #27ae60;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .material-info {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .material-info h5 {
            color: #3498db;
            margin: 0 0 10px 0;
        }
        
        .material-info p {
            margin: 5px 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ PBRæè´¨è¯†åˆ«ç³»ç»Ÿ</h1>
            <p>æ”¯æŒ10ç§ææ–™åˆ†ç±»ï¼Œæ–‡ä»¶åè‡ªåŠ¨è¯†åˆ«ï¼Œä¸‹æ‹‰èœå•é€‰æ‹©</p>
        </div>
        
        <div class="enhanced-features">
            <h4>âœ¨ ç³»ç»Ÿç‰¹ç‚¹</h4>
            <ul class="feature-list">
                <li>æ”¯æŒ10ç§ææ–™åˆ†ç±»ï¼ˆwood, metal, plastic, vinyl, paper, silicone, rubber, leather, stone, screen printï¼‰</li>
                <li>ä¸­è‹±æ–‡æ–‡ä»¶åè‡ªåŠ¨è¯†åˆ«</li>
                <li>ä¸‹æ‹‰èœå•å¿«é€Ÿé€‰æ‹©</li>
                <li>åŸºäºæè´¨æ•°æ®åº“çš„ç²¾å‡†å‚æ•°é¢„æµ‹</li>
                <li>ç½®ä¿¡åº¦æå‡æœºåˆ¶ï¼ˆæå‡15%-40%ï¼‰</li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h3>ğŸ“¤ å›¾ç‰‡ä¸Šä¼ </h3>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <p>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
                    <p style="font-size: 0.9rem; color: #7f8c8d;">æ”¯æŒ JPG, PNG, GIF æ ¼å¼</p>
                </div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                
                <div class="material-selection">
                    <h4>ğŸ” é€‰æ‹©ææ–™åˆ†ç±»ï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆæ¨èï¼‰</h4>
                    <p style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 15px;">
                        é€‰æ‹©ææ–™åˆ†ç±»å¯ä»¥å¤§å¹…æé«˜è¯†åˆ«ç²¾å‡†åº¦ï¼Œå¦‚æœä¸é€‰æ‹©ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹
                    </p>
                    
                    <div class="dropdown-container">
                        <label class="dropdown-label">ææ–™åˆ†ç±»ï¼š</label>
                        <select id="materialDropdown" class="material-dropdown">
                            <option value="">-- è‡ªåŠ¨æ£€æµ‹ --</option>
                        </select>
                    </div>
                    
                    <div id="materialInfo" class="material-info" style="display: none;">
                        <h5>ğŸ“‹ ææ–™ä¿¡æ¯</h5>
                        <div id="materialDetails"></div>
                    </div>
                </div>
                
                <button id="analyzeBtn" style="width: 100%; padding: 15px; background: #3498db; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; margin-top: 20px;">
                    å¼€å§‹åˆ†æ
                </button>
            </div>
            
            <div class="panel">
                <h3>ğŸ“Š åˆ†æç»“æœ</h3>
                <div id="status"></div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æå›¾ç‰‡ï¼Œè¯·ç¨å€™...</p>
                </div>
                <div id="results"></div>
            </div>
        </div>
        
        <div class="panel results-panel">
            <h3>ğŸ“ˆ è¯¦ç»†å‚æ•°</h3>
            <div id="detailedResults"></div>
        </div>
    </div>

    <!-- å¼•å…¥ Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- å¼•å…¥ Atomm UI (å·²åŒ…å«æœ¬åœ° Core ä»£ç å’Œ VueUse) -->
    <script src="https://minio-download.makeblock.com/resource/atomm-ui-umd/dist-browser/atomm-ui.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let selectedImage = null;
        let selectedFile = null;
        let selectedMaterial = null;
        let autoDetectedMaterial = null;
        let materials = [];
        
        const API_BASE = 'http://localhost:5001';
        
        // ææ–™åˆ†ç±»æ˜ å°„
        const materialMap = {
            'wood': { name: 'æœ¨æ', keywords: ['wood', 'æœ¨', 'æœ¨æ', 'oak', 'æ©¡æœ¨', 'pine', 'æ¾æœ¨'] },
            'metal': { name: 'é‡‘å±', keywords: ['metal', 'é‡‘å±', 'aluminum', 'é“', 'steel', 'é’¢', 'iron', 'é“', 'copper', 'é“œ'] },
            'plastic': { name: 'å¡‘æ–™', keywords: ['plastic', 'å¡‘æ–™', 'pvc', 'abs', 'poly'] },
            'vinyl': { name: 'ä¹™çƒ¯åŸº', keywords: ['vinyl', 'ä¹™çƒ¯åŸº', 'vinyl_', 'pvc'] },
            'paper': { name: 'çº¸å¼ ', keywords: ['paper', 'çº¸å¼ ', 'çº¸', 'cardboard', 'çº¸æ¿'] },
            'silicone': { name: 'ç¡…èƒ¶', keywords: ['silicone', 'ç¡…èƒ¶', 'silicone_', 'rubber'] },
            'rubber': { name: 'æ©¡èƒ¶', keywords: ['rubber', 'æ©¡èƒ¶', 'rubber_', 'latex'] },
            'leather': { name: 'çš®é©', keywords: ['leather', 'çš®é©', 'leather_', 'skin'] },
            'stone': { name: 'çŸ³æ', keywords: ['stone', 'çŸ³æ', 'stone_', 'marble', 'å¤§ç†çŸ³', 'granite', 'èŠ±å²—å²©'] },
            'screen_print': { name: 'ä¸ç½‘å°åˆ·', keywords: ['screen_print', 'ä¸ç½‘å°åˆ·', 'screen', 'å°åˆ·', 'print'] }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            loadMaterials();
            setupEventListeners();
        });
        
        // åŠ è½½ææ–™ä¿¡æ¯
        async function loadMaterials() {
            try {
                console.log('æ­£åœ¨åŠ è½½ææ–™ä¿¡æ¯...');
                const response = await fetch(`${API_BASE}/api/materials/all`);
                const data = await response.json();
                materials = data.materials;
                
                populateDropdown();
                console.log('ææ–™ä¿¡æ¯åŠ è½½å®Œæˆ');
            } catch (error) {
                console.error('åŠ è½½ææ–™ä¿¡æ¯å¤±è´¥:', error);
                showStatus('æ— æ³•åŠ è½½ææ–™ä¿¡æ¯ï¼Œå°†ä½¿ç”¨åŸºç¡€åˆ†ææ¨¡å¼', 'info');
            }
        }
        
        // å¡«å……ä¸‹æ‹‰èœå•
        function populateDropdown() {
            const dropdown = document.getElementById('materialDropdown');
            
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.id;
                option.textContent = `${material.name} (${material.id})`;
                dropdown.appendChild(option);
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            console.log('è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const materialDropdown = document.getElementById('materialDropdown');
            
            console.log('æ‰¾åˆ°å…ƒç´ :', { uploadArea, fileInput, analyzeBtn, materialDropdown });
            
            // æ–‡ä»¶ä¸Šä¼ 
            uploadArea.addEventListener('click', (e) => {
                console.log('ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ');
                e.preventDefault();
                fileInput.click();
            });
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                console.log('æ–‡ä»¶é€‰æ‹©å˜åŒ–:', e.target.files);
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
            
            // ææ–™é€‰æ‹©
            materialDropdown.addEventListener('change', (e) => {
                selectedMaterial = e.target.value;
                updateMaterialInfo();
                if (selectedMaterial) {
                    showStatus(`å·²é€‰æ‹©ææ–™: ${materialMap[selectedMaterial]?.name || selectedMaterial}`, 'success');
                } else {
                    showStatus('å·²åˆ‡æ¢åˆ°è‡ªåŠ¨æ£€æµ‹æ¨¡å¼', 'info');
                }
            });
            
            // åˆ†ææŒ‰é’®
            analyzeBtn.addEventListener('click', analyzeImage);
            
            console.log('äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
        }
        
        // æ›´æ–°ææ–™ä¿¡æ¯æ˜¾ç¤º
        function updateMaterialInfo() {
            const materialInfo = document.getElementById('materialInfo');
            const materialDetails = document.getElementById('materialDetails');
            
            if (selectedMaterial && materialMap[selectedMaterial]) {
                const material = materialMap[selectedMaterial];
                materialDetails.innerHTML = `
                    <p><strong>ä¸­æ–‡åç§°:</strong> ${material.name}</p>
                    <p><strong>è‹±æ–‡ID:</strong> ${selectedMaterial}</p>
                    <p><strong>å…³é”®è¯:</strong> ${material.keywords.join(', ')}</p>
                `;
                materialInfo.style.display = 'block';
            } else {
                materialInfo.style.display = 'none';
            }
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(file) {
            console.log('å¤„ç†æ–‡ä»¶:', file);
            
            if (!file.type.startsWith('image/')) {
                showStatus('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                selectedImage = e.target.result;
                selectedFile = file;
                const uploadArea = document.getElementById('uploadArea');
                
                // æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦åŒ…å«ææ–™ä¿¡æ¯
                const filename = file.name;
                const detectedInfo = detectMaterialFromFilename(filename);
                
                let statusMessage = 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ';
                if (detectedInfo) {
                    statusMessage += `ï¼Œæ£€æµ‹åˆ°ææ–™: ${detectedInfo.name} (${detectedInfo.id})`;
                    autoDetectedMaterial = detectedInfo.id;
                }
                
                uploadArea.innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    <p style="margin-top: 10px; color: #27ae60;">âœ“ å›¾ç‰‡å·²ä¸Šä¼ </p>
                    <p style="margin-top: 5px; font-size: 0.9rem; color: #7f8c8d;">æ–‡ä»¶å: ${filename}</p>
                    ${detectedInfo ? `<p style="margin-top: 5px; color: #27ae60; font-weight: 600;">ğŸ¯ è‡ªåŠ¨è¯†åˆ«: ${detectedInfo.name} (${detectedInfo.id})</p>` : ''}
                `;
                showStatus(statusMessage, 'success');
            };
            reader.readAsDataURL(file);
        }
        
        // ä»æ–‡ä»¶åæ£€æµ‹ææ–™
        function detectMaterialFromFilename(filename) {
            const nameWithoutExt = filename.toLowerCase().split('.')[0];
            
            // æ£€æŸ¥æ–‡ä»¶åä¸­æ˜¯å¦åŒ…å«å…³é”®è¯
            for (const [id, info] of Object.entries(materialMap)) {
                for (const keyword of info.keywords) {
                    if (nameWithoutExt.includes(keyword)) {
                        return { id, name: info.name };
                    }
                }
            }
            
            return null;
        }
        
        // åˆ†æå›¾ç‰‡
        async function analyzeImage() {
            if (!selectedImage) {
                showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error');
                return;
            }
            
            showLoading(true);
            showStatus('æ­£åœ¨åˆ†æå›¾ç‰‡...', 'info');
            
            try {
                const requestData = {
                    image: selectedImage
                };
                
                // ä¼˜å…ˆä½¿ç”¨æ‰‹åŠ¨é€‰æ‹©çš„ææ–™åˆ†ç±»
                if (selectedMaterial) {
                    requestData.materialCategory = selectedMaterial;
                    requestData.materialId = selectedMaterial;
                }
                // å¦‚æœæ²¡æœ‰æ‰‹åŠ¨é€‰æ‹©ï¼Œä½¿ç”¨è‡ªåŠ¨æ£€æµ‹çš„ææ–™åˆ†ç±»
                else if (autoDetectedMaterial) {
                    requestData.materialCategory = autoDetectedMaterial;
                    requestData.materialId = autoDetectedMaterial;
                }
                
                // æ·»åŠ æ–‡ä»¶åä¿¡æ¯
                if (selectedFile) {
                    requestData.filename = selectedFile.name;
                }
                
                const response = await fetch(`${API_BASE}/api/analyze/enhanced`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResults(data.results);
                    showStatus('åˆ†æå®Œæˆï¼', 'success');
                } else {
                    throw new Error(data.error || 'åˆ†æå¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ†æå¤±è´¥:', error);
                showStatus(`åˆ†æå¤±è´¥: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResults(results) {
            const resultsContainer = document.getElementById('results');
            const detailedContainer = document.getElementById('detailedResults');
            
            // ä¸»è¦ç»“æœ
            resultsContainer.innerHTML = `
                <div class="result-grid">
                    <div class="result-item">
                        <h4>é‡‘å±åº¦</h4>
                        <div class="result-value">${(results.metallic * 100).toFixed(1)}%</div>
                        <div class="result-bar">
                            <div class="result-bar-fill" style="width: ${results.metallic * 100}%"></div>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>ç²—ç³™åº¦</h4>
                        <div class="result-value">${(results.roughness * 100).toFixed(1)}%</div>
                        <div class="result-bar">
                            <div class="result-bar-fill" style="width: ${results.roughness * 100}%"></div>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>é€æ˜åº¦</h4>
                        <div class="result-value">${(results.transparency * 100).toFixed(1)}%</div>
                        <div class="result-bar">
                            <div class="result-bar-fill" style="width: ${results.transparency * 100}%"></div>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>ç½®ä¿¡åº¦</h4>
                        <div class="result-value">${(results.confidence * 100).toFixed(1)}%</div>
                        <div class="result-bar">
                            <div class="result-bar-fill ${getConfidenceClass(results.confidence)}" style="width: ${results.confidence * 100}%"></div>
                        </div>
                    </div>
                </div>
            `;
            
            // è¯¦ç»†ä¿¡æ¯
            let materialInfo = '';
            if (results.material_category) {
                materialInfo = `
                    <div style="background: rgba(39, 174, 96, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: #27ae60; margin: 0 0 10px 0;">ææ–™ä¿¡æ¯</h4>
                        <p style="margin: 5px 0;"><strong>åˆ†ç±»:</strong> ${results.material_category}</p>
                        ${results.material_name ? `<p style="margin: 5px 0;"><strong>æè´¨:</strong> ${results.material_name}</p>` : ''}
                        <p style="margin: 5px 0;"><strong>åˆ†æç±»å‹:</strong> ${results.analysis_type}</p>
                        <p style="margin: 5px 0;"><strong>ä½¿ç”¨ææ–™æç¤º:</strong> ${results.material_hint_used ? 'æ˜¯' : 'å¦'}</p>
                        ${results.auto_detected_from_filename ? `<p style="margin: 5px 0;"><strong>æ–‡ä»¶åè‡ªåŠ¨è¯†åˆ«:</strong> æ˜¯</p>` : ''}
                    </div>
                `;
            }
            
            detailedContainer.innerHTML = `
                ${materialInfo}
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 15px 0; color: #2c3e50;">åŸºç¡€é¢œè‰²</h4>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; border-radius: 8px; background: rgb(${results.base_color.join(',')}); border: 2px solid #ecf0f1;"></div>
                            <div>
                                <p style="margin: 5px 0;"><strong>RGB:</strong> ${results.base_color.join(', ')}</p>
                                <p style="margin: 5px 0;"><strong>åå…­è¿›åˆ¶:</strong> #${results.base_color.map(c => c.toString(16).padStart(2, '0')).join('')}</p>
                            </div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 15px 0; color: #2c3e50;">æ³•çº¿å¼ºåº¦</h4>
                        <div class="result-value">${(results.normalStrength * 100).toFixed(1)}%</div>
                        <div class="result-bar">
                            <div class="result-bar-fill" style="width: ${results.normalStrength * 100}%"></div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 15px 0; color: #2c3e50;">åˆ†ææ—¶é—´</h4>
                        <p style="margin: 5px 0;"><strong>æ—¶é—´æˆ³:</strong> ${new Date(results.timestamp).toLocaleString()}</p>
                        <p style="margin: 5px 0;"><strong>åˆ†æç±»å‹:</strong> ${results.analysis_type}</p>
                    </div>
                </div>
            `;
        }
        
        // è·å–ç½®ä¿¡åº¦æ ·å¼ç±»
        function getConfidenceClass(confidence) {
            if (confidence >= 0.7) return 'confidence-high';
            if (confidence >= 0.4) return 'confidence-medium';
            return 'confidence-low';
        }
        
        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusContainer = document.getElementById('status');
            statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html> 